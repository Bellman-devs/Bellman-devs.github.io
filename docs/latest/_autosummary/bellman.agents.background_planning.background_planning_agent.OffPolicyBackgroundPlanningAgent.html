

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent &mdash; Bellman 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/color_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="bellman.agents.background_planning.background_planning_agent.OnPolicyBackgroundPlanningAgent" href="bellman.agents.background_planning.background_planning_agent.OnPolicyBackgroundPlanningAgent.html" />
    <link rel="prev" title="bellman.agents.background_planning.background_planning_agent.BackgroundPlanningAgent" href="bellman.agents.background_planning.background_planning_agent.BackgroundPlanningAgent.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Bellman
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Jupyter Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/approximate_mdps.html">Approximating MDPs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/model_visualisation.html">Learning from samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/trajectory_optimisation.html">Trajectory Optimisation</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="bellman.html">bellman</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="bellman.agents.html">bellman.agents</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="bellman.agents.background_planning.html">bellman.agents.background_planning</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="bellman.agents.background_planning.background_planning_agent.html">bellman.agents.background_planning.background_planning_agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="bellman.agents.background_planning.model_free_agent_types.html">bellman.agents.background_planning.model_free_agent_types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="bellman.agents.components.html">bellman.agents.components</a></li>
<li class="toctree-l3"><a class="reference internal" href="bellman.agents.decision_time_planning.html">bellman.agents.decision_time_planning</a></li>
<li class="toctree-l3"><a class="reference internal" href="bellman.agents.mbpo.html">bellman.agents.mbpo</a></li>
<li class="toctree-l3"><a class="reference internal" href="bellman.agents.mepo.html">bellman.agents.mepo</a></li>
<li class="toctree-l3"><a class="reference internal" href="bellman.agents.model_based_agent.html">bellman.agents.model_based_agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="bellman.agents.pets.html">bellman.agents.pets</a></li>
<li class="toctree-l3"><a class="reference internal" href="bellman.agents.trpo.html">bellman.agents.trpo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bellman.benchmark.html">bellman.benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="bellman.distributions.html">bellman.distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="bellman.drivers.html">bellman.drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="bellman.environments.html">bellman.environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="bellman.harness.html">bellman.harness</a></li>
<li class="toctree-l2"><a class="reference internal" href="bellman.networks.html">bellman.networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="bellman.policies.html">bellman.policies</a></li>
<li class="toctree-l2"><a class="reference internal" href="bellman.training.html">bellman.training</a></li>
<li class="toctree-l2"><a class="reference internal" href="bellman.trajectory_optimisers.html">bellman.trajectory_optimisers</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bellman</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="bellman.html">bellman</a> &raquo;</li>
        
          <li><a href="bellman.agents.html">bellman.agents</a> &raquo;</li>
        
          <li><a href="bellman.agents.background_planning.html">bellman.agents.background_planning</a> &raquo;</li>
        
          <li><a href="bellman.agents.background_planning.background_planning_agent.html">bellman.agents.background_planning.background_planning_agent</a> &raquo;</li>
        
      <li>bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="bellman-agents-background-planning-background-planning-agent-offpolicybackgroundplanningagent">
<h1>bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent<a class="headerlink" href="#bellman-agents-background-planning-background-planning-agent-offpolicybackgroundplanningagent" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">bellman.agents.background_planning.background_planning_agent.</span></code><code class="sig-name descname"><span class="pre">OffPolicyBackgroundPlanningAgent</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transition_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_state_distribution_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_free_agent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">planner_batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">planning_horizon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_free_training_iterations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">virtual_sample_batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug_summaries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_step_counter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/bellman/agents/background_planning/background_planning_agent.html#OffPolicyBackgroundPlanningAgent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="bellman.agents.background_planning.background_planning_agent.BackgroundPlanningAgent.html#bellman.agents.background_planning.background_planning_agent.BackgroundPlanningAgent" title="bellman.agents.background_planning.background_planning_agent.BackgroundPlanningAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">bellman.agents.background_planning.background_planning_agent.BackgroundPlanningAgent</span></code></a></p>
<p>An agent for off-policy background planning with an internal off-policy model-free agent.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transition_model</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference internal" href="bellman.environments.transition_model.transition_model.TrainableTransitionModel.html#bellman.environments.transition_model.transition_model.TrainableTransitionModel" title="bellman.environments.transition_model.transition_model.TrainableTransitionModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrainableTransitionModel</span></code></a>, <a class="reference internal" href="bellman.environments.transition_model.transition_model.TransitionModelTrainingSpec.html#bellman.environments.transition_model.transition_model.TransitionModelTrainingSpec" title="bellman.environments.transition_model.transition_model.TransitionModelTrainingSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransitionModelTrainingSpec</span></code></a>], <a class="reference internal" href="bellman.environments.transition_model.transition_model.TransitionModel.html#bellman.environments.transition_model.transition_model.TransitionModel" title="bellman.environments.transition_model.transition_model.TransitionModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransitionModel</span></code></a>]) – A component of the environment model that describes the
transition dynamics. Either a tuple containing a trainable transition model together
with training specs, or a pre-specified transition model.</p></li>
<li><p><strong>reward_model</strong> (<a class="reference internal" href="bellman.environments.reward_model.RewardModel.html#bellman.environments.reward_model.RewardModel" title="bellman.environments.reward_model.RewardModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">RewardModel</span></code></a>) – A component of the environment model that describes the
rewards. At the moment only pre-specified reward models are allowed, i.e. the agent
assumes the reward function is known.</p></li>
<li><p><strong>initial_state_distribution_model</strong> (<a class="reference internal" href="bellman.environments.initial_state_distribution_model.InitialStateDistributionModel.html#bellman.environments.initial_state_distribution_model.InitialStateDistributionModel" title="bellman.environments.initial_state_distribution_model.InitialStateDistributionModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">InitialStateDistributionModel</span></code></a>) – A component of the environment model that
describes the initial state distribution (can be both deterministic or
probabilistic). At the moment only pre-specified initial state distribution models
are allowed, i.e. the agent assumes the initial state distribution is known.</p></li>
<li><p><strong>model_free_agent</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">TFAgent</span></code>) – off-policy model-free agent that is trained virtually with samples
from the model. Could be for example DDPG, TD3 or SAC.</p></li>
<li><p><strong>planner_batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Number of parallel virtual trajectories.</p></li>
<li><p><strong>planning_horizon</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Number of steps taken in the environment in each virtual rollout.</p></li>
<li><p><strong>model_free_training_iterations</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Number of model-free training iterations per each
train-call.</p></li>
<li><p><strong>virtual_sample_batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – sample batch size for virtually training the off-policy
model-free agent.</p></li>
<li><p><strong>debug_summaries</strong> – A bool; if true, subclasses should gather debug summaries.</p></li>
<li><p><strong>train_step_counter</strong> – An optional counter to increment every time the train op is run.
Defaults to the global_step.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Methods</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.initialize" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.initialize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">initialize</span></code></a></p></td>
<td><p>Initializes the agent.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.loss" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.loss"><code class="xref py py-obj docutils literal notranslate"><span class="pre">loss</span></code></a></p></td>
<td><p>Gets loss from the agent.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.preprocess_sequence" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.preprocess_sequence"><code class="xref py py-obj docutils literal notranslate"><span class="pre">preprocess_sequence</span></code></a></p></td>
<td><p>Defines preprocess_sequence function to be fed into replay buffers.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train"><code class="xref py py-obj docutils literal notranslate"><span class="pre">train</span></code></a></p></td>
<td><p>Trains the agent.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.with_name_scope" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.with_name_scope"><code class="xref py py-obj docutils literal notranslate"><span class="pre">with_name_scope</span></code></a></p></td>
<td><p>Decorator to automatically enter the module name scope.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Attributes</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.action_spec" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.action_spec"><code class="xref py py-obj docutils literal notranslate"><span class="pre">action_spec</span></code></a></p></td>
<td><p>TensorSpec describing the action produced by the agent.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">collect_data_context</span></code></p></td>
<td><p><dl class="field-list simple">
<dt class="field-odd">rtype</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataContext</span></code></p>
</dd>
</dl>
</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.collect_data_spec" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.collect_data_spec"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collect_data_spec</span></code></a></p></td>
<td><p>Returns a <cite>Trajectory</cite> spec, as expected by the <cite>collect_policy</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.collect_policy" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.collect_policy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collect_policy</span></code></a></p></td>
<td><p>Return a policy that can be used to collect data from the environment.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">data_context</span></code></p></td>
<td><p><dl class="field-list simple">
<dt class="field-odd">rtype</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataContext</span></code></p>
</dd>
</dl>
</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">debug_summaries</span></code></p></td>
<td><p><dl class="field-list simple">
<dt class="field-odd">rtype</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.initial_state_distribution_model" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.initial_state_distribution_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">initial_state_distribution_model</span></code></a></p></td>
<td><p>return the initial state distribution model.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.name" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.name"><code class="xref py py-obj docutils literal notranslate"><span class="pre">name</span></code></a></p></td>
<td><p>Returns the name of this module as passed or determined in the ctor.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.name_scope" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.name_scope"><code class="xref py py-obj docutils literal notranslate"><span class="pre">name_scope</span></code></a></p></td>
<td><p>Returns a <cite>tf.name_scope</cite> instance for this class.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.policy" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.policy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">policy</span></code></a></p></td>
<td><p>Return the current policy held by the agent.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.reward_model" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.reward_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">reward_model</span></code></a></p></td>
<td><p>return the reward model.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.submodules" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.submodules"><code class="xref py py-obj docutils literal notranslate"><span class="pre">submodules</span></code></a></p></td>
<td><p>Sequence of all sub-modules.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">summaries_enabled</span></code></p></td>
<td><p><dl class="field-list simple">
<dt class="field-odd">rtype</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">summarize_grads_and_vars</span></code></p></td>
<td><p><dl class="field-list simple">
<dt class="field-odd">rtype</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.termination_model" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.termination_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">termination_model</span></code></a></p></td>
<td><p>return the termination model.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.time_step_spec" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.time_step_spec"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time_step_spec</span></code></a></p></td>
<td><p>Describes the <cite>TimeStep</cite> tensors expected by the agent.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train_argspec" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train_argspec"><code class="xref py py-obj docutils literal notranslate"><span class="pre">train_argspec</span></code></a></p></td>
<td><p>TensorSpec describing extra supported <cite>kwargs</cite> to <cite>train()</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train_sequence_length" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train_sequence_length"><code class="xref py py-obj docutils literal notranslate"><span class="pre">train_sequence_length</span></code></a></p></td>
<td><p>The number of time steps needed in experience tensors passed to <cite>train</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">train_step_counter</span></code></p></td>
<td><p><dl class="field-list simple">
<dt class="field-odd">rtype</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Variable</span></code></p>
</dd>
</dl>
</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.trainable_variables" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.trainable_variables"><code class="xref py py-obj docutils literal notranslate"><span class="pre">trainable_variables</span></code></a></p></td>
<td><p>Sequence of trainable variables owned by this module and its submodules.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.training_data_spec" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.training_data_spec"><code class="xref py py-obj docutils literal notranslate"><span class="pre">training_data_spec</span></code></a></p></td>
<td><p>Returns a trajectory spec, as expected by the train() function.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.transition_model" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.transition_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">transition_model</span></code></a></p></td>
<td><p>return the transition model.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.validate_args" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.validate_args"><code class="xref py py-obj docutils literal notranslate"><span class="pre">validate_args</span></code></a></p></td>
<td><p>Whether <cite>train</cite> &amp; <cite>preprocess_sequence</cite> validate input &amp; output args.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.variables" title="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.variables"><code class="xref py py-obj docutils literal notranslate"><span class="pre">variables</span></code></a></p></td>
<td><p>Sequence of variables owned by this module and its submodules.</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.action_spec">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">action_spec</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.action_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>TensorSpec describing the action produced by the agent.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>An single BoundedTensorSpec, or a nested dict, list or tuple of
<cite>BoundedTensorSpec</cite> objects, which describe the shape and
dtype of each action Tensor.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TensorSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RaggedTensorSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SparseTensorSpec</span></code>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.collect_data_spec">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">collect_data_spec</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.collect_data_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <cite>Trajectory</cite> spec, as expected by the <cite>collect_policy</cite>.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>A <cite>Trajectory</cite> spec.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TensorSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RaggedTensorSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SparseTensorSpec</span></code>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.collect_policy">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">collect_policy</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.collect_policy" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a policy that can be used to collect data from the environment.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>A <cite>tf_policy.TFPolicy</cite> object.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">TFPolicy</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.initial_state_distribution_model">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">initial_state_distribution_model</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.initial_state_distribution_model" title="Permalink to this definition">¶</a></dt>
<dd><p>return the initial state distribution model.</p>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.initialize">
<code class="sig-name descname"><span class="pre">initialize</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes the agent.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>An operation that can be used to initialize the agent.</p>
</dd>
<dt>Raises:</dt><dd><dl class="simple">
<dt>RuntimeError: If the class was not initialized properly (<cite>super.__init__</cite></dt><dd><p>was not called).</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Operation</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.loss">
<code class="sig-name descname"><span class="pre">loss</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experience</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.loss" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets loss from the agent.</p>
<p>If the user calls this from _train, it must be in a <cite>tf.GradientTape</cite> scope
in order to apply gradients to trainable variables.
If intermediate gradient steps are needed, _loss and _train will return
different values since _loss only supports updating all gradients at once
after all losses have been calculated.</p>
<dl>
<dt>Args:</dt><dd><dl class="simple">
<dt>experience: A batch of experience data in the form of a <cite>Trajectory</cite>. The</dt><dd><p>structure of <cite>experience</cite> must match that of <cite>self.training_data_spec</cite>.
All tensors in <cite>experience</cite> must be shaped <cite>[batch, time, …]</cite> where
<cite>time</cite> must be equal to <cite>self.train_step_length</cite> if that
property is not <cite>None</cite>.</p>
</dd>
<dt>weights: (optional).  A <cite>Tensor</cite>, either <cite>0-D</cite> or shaped <cite>[batch]</cite>,</dt><dd><p>containing weights to be used when calculating the total train loss.
Weights are typically multiplied elementwise against the per-batch loss,
but the implementation is up to the Agent.</p>
</dd>
</dl>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs: Any additional data as args to <cite>loss</cite>.</p>
</dd>
<dt>Returns:</dt><dd><p>A <cite>LossInfo</cite> loss tuple containing loss and info tensors.</p>
</dd>
<dt>Raises:</dt><dd><dl class="simple">
<dt>TypeError: If <cite>validate_args is True</cite> and: Experience is not type</dt><dd><p><cite>Trajectory</cite>; or if <cite>experience</cite>  does not match
<cite>self.training_data_spec</cite> structure types.</p>
</dd>
<dt>ValueError: If <cite>validate_args is True</cite> and: Experience tensors’ time axes</dt><dd><p>are not compatible with <cite>self.train_sequence_length</cite>; or if experience
does not match <cite>self.training_data_spec</cite> structure.</p>
</dd>
<dt>ValueError: If <cite>validate_args is True</cite> and the user does not pass</dt><dd><p><cite>**kwargs</cite> matching <cite>self.train_argspec</cite>.</p>
</dd>
<dt>RuntimeError: If the class was not initialized properly (<cite>super.__init__</cite></dt><dd><p>was not called).</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">LossInfo</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.name">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">name</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the name of this module as passed or determined in the ctor.</p>
<p>NOTE: This is not the same as the <cite>self.name_scope.name</cite> which includes
parent module names.</p>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.name_scope">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">name_scope</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.name_scope" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <cite>tf.name_scope</cite> instance for this class.</p>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.policy">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">policy</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.policy" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current policy held by the agent.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>A <cite>tf_policy.TFPolicy</cite> object.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">TFPolicy</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.preprocess_sequence">
<code class="sig-name descname"><span class="pre">preprocess_sequence</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experience</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.preprocess_sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines preprocess_sequence function to be fed into replay buffers.</p>
<p>This defines how we preprocess the collected data before training.
Defaults to pass through for most agents.
Structure of <cite>experience</cite> must match that of <cite>self.collect_data_spec</cite>.</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="simple">
<dt>experience: a <cite>Trajectory</cite> shaped [batch, time, …] or [time, …] which</dt><dd><p>represents the collected experience data.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><p>A post processed <cite>Trajectory</cite> with the same shape as the input.</p>
</dd>
<dt>Raises:</dt><dd><dl class="simple">
<dt>TypeError: If experience does not match <cite>self.collect_data_spec</cite> structure</dt><dd><p>types.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SparseTensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RaggedTensor</span></code>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.reward_model">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">reward_model</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.reward_model" title="Permalink to this definition">¶</a></dt>
<dd><p>return the reward model.</p>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.submodules">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">submodules</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.submodules" title="Permalink to this definition">¶</a></dt>
<dd><p>Sequence of all sub-modules.</p>
<p>Submodules are modules which are properties of this module, or found as
properties of modules which are properties of this module (and so on).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Module</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Module</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Module</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">submodules</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">submodules</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">submodules</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]</span>
<span class="go">True</span>
</pre></div>
</div>
<dl class="simple">
<dt>Returns:</dt><dd><p>A sequence of all submodules.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.termination_model">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">termination_model</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.termination_model" title="Permalink to this definition">¶</a></dt>
<dd><p>return the termination model.</p>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.time_step_spec">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">time_step_spec</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.time_step_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Describes the <cite>TimeStep</cite> tensors expected by the agent.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>A <cite>TimeStep</cite> namedtuple with <cite>TensorSpec</cite> objects instead of Tensors,
which describe the shape, dtype and name of each tensor.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeStep</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train">
<code class="sig-name descname"><span class="pre">train</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experience</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Trains the agent.</p>
<dl>
<dt>Args:</dt><dd><dl class="simple">
<dt>experience: A batch of experience data in the form of a <cite>Trajectory</cite>. The</dt><dd><p>structure of <cite>experience</cite> must match that of <cite>self.training_data_spec</cite>.
All tensors in <cite>experience</cite> must be shaped <cite>[batch, time, …]</cite> where
<cite>time</cite> must be equal to <cite>self.train_step_length</cite> if that
property is not <cite>None</cite>.</p>
</dd>
<dt>weights: (optional).  A <cite>Tensor</cite>, either <cite>0-D</cite> or shaped <cite>[batch]</cite>,</dt><dd><p>containing weights to be used when calculating the total train loss.
Weights are typically multiplied elementwise against the per-batch loss,
but the implementation is up to the Agent.</p>
</dd>
</dl>
<p><a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs: Any additional data as declared by <cite>self.train_argspec</cite>.</p>
</dd>
<dt>Returns:</dt><dd><p>A <cite>LossInfo</cite> loss tuple containing loss and info tensors.
- In eager mode, the loss values are first calculated, then a train step</p>
<blockquote>
<div><p>is performed before they are returned.</p>
</div></blockquote>
<ul class="simple">
<li><p>In graph mode, executing any or all of the loss tensors
will first calculate the loss value(s), then perform a train step,
and return the pre-train-step <cite>LossInfo</cite>.</p></li>
</ul>
</dd>
<dt>Raises:</dt><dd><dl class="simple">
<dt>TypeError: If <cite>validate_args is True</cite> and: Experience is not type</dt><dd><p><cite>Trajectory</cite>; or if <cite>experience</cite>  does not match
<cite>self.training_data_spec</cite> structure types.</p>
</dd>
<dt>ValueError: If <cite>validate_args is True</cite> and: Experience tensors’ time axes</dt><dd><p>are not compatible with <cite>self.train_sequence_length</cite>; or if experience
does not match <cite>self.training_data_spec</cite> structure.</p>
</dd>
<dt>ValueError: If <cite>validate_args is True</cite> and the user does not pass</dt><dd><p><cite>**kwargs</cite> matching <cite>self.train_argspec</cite>.</p>
</dd>
<dt>RuntimeError: If the class was not initialized properly (<cite>super.__init__</cite></dt><dd><p>was not called).</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">LossInfo</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train_argspec">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">train_argspec</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train_argspec" title="Permalink to this definition">¶</a></dt>
<dd><p>TensorSpec describing extra supported <cite>kwargs</cite> to <cite>train()</cite>.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>A <cite>dict</cite> mapping kwarg strings to nests of <cite>tf.TypeSpec</cite> objects (or
<cite>None</cite> if there is no <cite>train_argspec</cite>).</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TensorSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RaggedTensorSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SparseTensorSpec</span></code>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>]]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train_sequence_length">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">train_sequence_length</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.train_sequence_length" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of time steps needed in experience tensors passed to <cite>train</cite>.</p>
<p>Train requires experience to be a <cite>Trajectory</cite> containing tensors shaped
<cite>[B, T, …]</cite>.  This argument describes the value of <cite>T</cite> required.</p>
<p>For example, for non-RNN DQN training, <cite>T=2</cite> because DQN requires single
transitions.</p>
<p>If this value is <cite>None</cite>, then <cite>train</cite> can handle an unknown <cite>T</cite> (it can be
determined at runtime from the data).  Most RNN-based agents fall into
this category.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>The number of time steps needed in experience tensors passed to <cite>train</cite>.
May be <cite>None</cite> to mean no constraint.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.trainable_variables">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">trainable_variables</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.trainable_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Sequence of trainable variables owned by this module and its submodules.</p>
<p>Note: this method uses reflection to find variables on the current instance
and submodules. For performance reasons you may wish to cache the result
of calling this method if you don’t expect the return value to change.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>A sequence of variables for the current module (sorted by attribute
name) followed by variables from all submodules recursively (breadth
first).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.training_data_spec">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">training_data_spec</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.training_data_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a trajectory spec, as expected by the train() function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TensorSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RaggedTensorSpec</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SparseTensorSpec</span></code>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ForwardRef" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardRef</span></code></a>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.transition_model">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">transition_model</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.transition_model" title="Permalink to this definition">¶</a></dt>
<dd><p>return the transition model.</p>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.validate_args">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">validate_args</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.validate_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether <cite>train</cite> &amp; <cite>preprocess_sequence</cite> validate input &amp; output args.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.variables">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">variables</span></code><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Sequence of variables owned by this module and its submodules.</p>
<p>Note: this method uses reflection to find variables on the current instance
and submodules. For performance reasons you may wish to cache the result
of calling this method if you don’t expect the return value to change.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>A sequence of variables for the current module (sorted by attribute
name) followed by variables from all submodules recursively (breadth
first).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.with_name_scope">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">with_name_scope</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bellman.agents.background_planning.background_planning_agent.OffPolicyBackgroundPlanningAgent.with_name_scope" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to automatically enter the module name scope.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="gp">... </span>  <span class="nd">@tf</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">with_name_scope</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">):</span>
<span class="gp">... </span>      <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">]))</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the above module would produce <a href="#id5"><span class="problematic" id="id6">`</span></a>tf.Variable`s and <a href="#id7"><span class="problematic" id="id8">`</span></a>tf.Tensor`s whose
names included the module name:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mod</span> <span class="o">=</span> <span class="n">MyModule</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
<span class="go">&lt;tf.Tensor: shape=(1, 3), dtype=float32, numpy=..., dtype=float32)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod</span><span class="o">.</span><span class="n">w</span>
<span class="go">&lt;tf.Variable &#39;my_module/Variable:0&#39; shape=(2, 3) dtype=float32,</span>
<span class="go">numpy=..., dtype=float32)&gt;</span>
</pre></div>
</div>
<dl class="simple">
<dt>Args:</dt><dd><p>method: The method to wrap.</p>
</dd>
<dt>Returns:</dt><dd><p>The original method wrapped such that it enters the module’s name scope.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="bellman.agents.background_planning.background_planning_agent.OnPolicyBackgroundPlanningAgent.html" class="btn btn-neutral float-right" title="bellman.agents.background_planning.background_planning_agent.OnPolicyBackgroundPlanningAgent" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="bellman.agents.background_planning.background_planning_agent.BackgroundPlanningAgent.html" class="btn btn-neutral float-left" title="bellman.agents.background_planning.background_planning_agent.BackgroundPlanningAgent" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, The Bellman Contributors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>